{
  "_beagleComponent_": "beagle:container",
  "version": "Beagle Keep v1.0",
  "style": {
    "height": "100%",
    "flex": 1,
    "alignItems": "center",
    "justifyContent": "center",
    "backgroundColor": "#111",
    "color": "#FFF"
  },
  "context": {
    "id": "labels",
    "value": {
      "current": [
        {
          "id": 0,
          "name": "Personal",
          "color": "#00ff00"
        },
        {
          "id": 1,
          "name": "Work",
          "color": "#0000ff"
        },
        {
          "id": 2,
          "name": "Urgent",
          "color": "#ff0000"
        },
        {
          "id": 3,
          "name": "Supermarket",
          "color": "#ffff00"
        }
      ]
    }
  },
  "children": [
    {
      "_beagleComponent_": "custom:repeater",
      "id": "label-list",
      "style": {
        "maxWidth": "500px",
        "flexDirection": "column",
        "borderRadius": "20px",
        "padding": "15px",
        "backgroundColor": "#333"
      },
      "dataSource": [
        {
          "id": 0,
          "name": "Personal",
          "color": "#00ff00"
        },
        {
          "id": 1,
          "name": "Work",
          "color": "#0000ff"
        },
        {
          "id": 2,
          "name": "Urgent",
          "color": "#ff0000"
        },
        {
          "id": 3,
          "name": "Supermarket",
          "color": "#ffff00"
        }
      ],
      "key": "id",
      "template": {
        "_beagleComponent_": "custom:editableLabel",
        "context": {
          "id": "isLoading",
          "value": false
        },
        "isLoading": "@{isLoading}",
        "label": "@{item}",
        "onSave": [
          {
            "_beagleAction_": "beagle:setContext",
            "contextId": "isLoading",
            "value": true
          },
          {
            "_beagleAction_": "beagle:sendRequest",
            "url": "https://keep.beagle.io/label",
            "method": "@{condition(isEmpty(item.id), 'POST', 'PUT')}",
            "data": "@{onSave.value}",
            "onSuccess": [
              {
                "_beagleAction_": "beagle:condition",
                "condition": "isEmpty(item.id)",
                "onTrue": [
                  {
                    "_beagleAction_": "beagle:setContext",
                    "contextId": "labels",
                    "value": {
                      "current": "@{insert(labels.current, onSuccess.data)}"
                    }
                  }
                ],
                "onFalse": [
                  {
                    "_beagleAction_": "beagle:setContext",
                    "contextId": "labels",
                    "path": "current[@{index}]",
                    "value": "@{onSuccess.data}"
                  }
                ]
              }
            ],
            "onError": [
              {
                "_beagleAction_": "custom:feedback",
                "type": "error",
                "message": "@{error.data.message}"
              }
            ],
            "onFinish": [
              {
                "_beagleAction_": "beagle:setContext",
                "contextId": "isLoading",
                "value": false
              }
            ]
          }
        ],
        "onRemove": [
          {
            "_beagleAction_": "beagle:condition",
            "condition": "@{isEmpty(item.id)}",
            "onTrue": [
              {
                "_beagleAction_": "beagle:setContext",
                "contextId": "labels",
                "path": "new"
              }
            ],
            "onFalse": [
              {
                "_beagleAction_": "beagle:setContext",
                "contextId": "isLoading",
                "value": true
              },
              {
                "_beagleAction_": "beagle:sendRequest",
                "url": "https://keep.beagle.io/label/@{item.id}",
                "method": "DELETE",
                "onSuccess": [
                  {
                    "_beagleAction_": "beagle:setContext",
                    "contextId": "labels",
                    "path": "current",
                    "value": "@{remove(labels.current, item)}"
                  }
                ],
                "onError": [
                  {
                    "_beagleAction_": "custom:feedback",
                    "type": "error",
                    "message": "Error while deleting label."
                  },
                  {
                    "_beagleAction_": "beagle:setContext",
                    "contextId": "isLoading",
                    "value": false
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    {
      "_beagleComponent_": "beagle:container",
      "style": {
        "flex": 1,
        "justifyContent": "space-between",
        "flexDirection": "row",
        "color": "#FFF"
      },
      "children": [
        {
          "_beagleComponent_": "beagle:button",
          "text": "Go back",
          "onPress": "__function__",
          "id": "_beagle_1",
          "isSubmit": false
        },
        {
          "_beagleComponent_": "beagle:button",
          "text": "Create new label",
          "onPress": "__function__",
          "disabled": false,
          "id": "_beagle_2",
          "isSubmit": false
        }
      ],
      "id": "container:1"
    }
  ],
  "id": "container:0"
}
